---
- name: puppeteers.prometheus.node_exporter | validate parameters
  ansible.builtin.assert:
    that:
      - node_exporter_firewalld_zone is string

- name: puppeteers.prometheus.node_exporter | install package
  ansible.builtin.package:
    name: prometheus-node-exporter
    state: present

- name: puppeteers.prometheus.node_exporter | enable service
  ansible.builtin.service:
    name: node_exporter
    enabled: true
    state: started

- name: puppeteers.prometheus.node_exporter | open hole in firewall
  ansible.builtin.firewalld:
    zone: "{{ node_exporter_firewalld_zone }}"
    service: prometheus-node-exporter
    state: enabled
    immediate: true
    permanent: true
